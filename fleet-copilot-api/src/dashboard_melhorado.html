<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI Serviços - Inteligência Analítica na Gestão de Frotas</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-dark: #2c3e50;
            --secondary-dark: #34495e;
            --teal-primary: #1abc9c;
            --teal-secondary: #16a085;
            --purple-primary: #9b59b6;
            --purple-secondary: #8e44ad;
            --text-light: #ecf0f1;
            --text-muted: #bdc3c7;
            --border-color: #34495e;
            --card-bg: #2c3e50;
            --hover-bg: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            color: var(--text-light);
            min-height: 100vh;
        }

        /* Header RCS */
        .header-rcs {
            background: var(--teal-primary);
            padding: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
            color: white !important;
            padding: 15px 20px;
            background: rgba(0,0,0,0.2);
        }

        .nav-item {
            margin: 0 2px;
        }

        .nav-link {
            color: white !important;
            padding: 15px 20px !important;
            transition: all 0.3s ease;
            border-radius: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            color: white !important;
        }

        .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white !important;
        }

        /* Main Content */
        .main-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Page Header */
        .page-header {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .page-title i {
            background: var(--teal-primary);
            color: white;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.2rem;
        }

        .page-title h1 {
            color: var(--text-light);
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }

        .page-subtitle {
            color: var(--text-muted);
            margin: 0;
            font-size: 1rem;
        }

        /* Filters Section */
        .filters-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control, .form-select {
            background: var(--secondary-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            border-radius: 8px;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            background: var(--secondary-dark);
            border-color: var(--teal-primary);
            color: var(--text-light);
            box-shadow: 0 0 0 0.2rem rgba(26, 188, 156, 0.25);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        .form-select option {
            background: var(--secondary-dark);
            color: var(--text-light);
        }

        /* Quick Filters */
        .quick-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-filter-btn {
            background: transparent;
            border: 1px solid var(--teal-primary);
            color: var(--teal-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quick-filter-btn:hover, .quick-filter-btn.active {
            background: var(--teal-primary);
            color: white;
        }

        /* Action Buttons */
        .filter-actions {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        .btn-primary {
            background: var(--teal-primary);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--teal-secondary);
            transform: translateY(-2px);
        }

        .btn-outline-primary {
            border: 1px solid var(--teal-primary);
            color: var(--teal-primary);
            background: transparent;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: var(--teal-primary);
            color: white;
        }

        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--teal-primary), var(--purple-primary));
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-title {
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 500;
            margin: 0;
        }

        .metric-icon {
            background: var(--teal-primary);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--teal-primary);
            margin-bottom: 10px;
        }

        .metric-subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* DataTable Section */
        .datatable-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .datatable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .datatable-title {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .export-btn {
            background: var(--teal-primary);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--teal-secondary);
            transform: translateY(-2px);
        }

        /* DataTables Custom Styling */
        .table-dark {
            --bs-table-bg: var(--secondary-dark);
            --bs-table-border-color: var(--border-color);
        }

        .table-dark th {
            background: var(--teal-primary) !important;
            border-color: var(--border-color) !important;
            color: white !important;
            font-weight: 600;
            padding: 15px 12px;
        }

        .table-dark td {
            border-color: var(--border-color) !important;
            color: var(--text-light) !important;
            padding: 12px;
        }

        .table-dark tbody tr:hover {
            background: var(--hover-bg) !important;
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--teal-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .filters-row {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-link {
                padding: 10px 15px !important;
                font-size: 0.9rem;
            }
            
            .nav-link span {
                display: none;
            }
        }

        /* Collection Selector */
        .collection-selector {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .collection-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .collection-tab {
            background: transparent;
            border: 1px solid var(--teal-primary);
            color: var(--teal-primary);
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .collection-tab:hover, .collection-tab.active {
            background: var(--teal-primary);
            color: white;
            transform: translateY(-2px);
        }

        .collection-tab i {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Header RCS -->
    <nav class="navbar navbar-expand-lg header-rcs">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-cube"></i> RCS
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-map"></i>
                            <span>Mapa</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-truck"></i>
                            <span>Frota</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-users"></i>
                            <span>Usuários App</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-car"></i>
                            <span>Veículos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-gas-pump"></i>
                            <span>Combustível</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Inspeção</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-wrench"></i>
                            <span>Manutenção</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Ordem de Serviço</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Dispositivos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Geocercas</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-gamepad"></i>
                            <span>Gamificação</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Treinamento</span>
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-cog"></i>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-title">
                <i class="fas fa-chart-bar"></i>
                <div>
                    <h1>BI Serviços</h1>
                    <p class="page-subtitle">Inteligência Analítica na Gestão de Frotas com Telemática Móvel</p>
                </div>
            </div>
        </div>

        <!-- Collection Selector -->
        <div class="collection-selector">
            <div class="collection-tabs">
                <button class="collection-tab active" data-collection="checklist">
                    <i class="fas fa-clipboard-check"></i>
                    Checklist
                </button>
                <button class="collection-tab" data-collection="trips">
                    <i class="fas fa-route"></i>
                    Viagens
                </button>
                <button class="collection-tab" data-collection="alerts">
                    <i class="fas fa-exclamation-triangle"></i>
                    Alertas
                </button>
                <button class="collection-tab" data-collection="maintenance">
                    <i class="fas fa-wrench"></i>
                    Manutenção
                </button>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Data Inicial</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Data Final</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Garagem</label>
                    <select class="form-select" id="garageFilter">
                        <option value="">Todas as Garagens</option>
                        <option value="garagem1">Garagem 1</option>
                        <option value="garagem2">Garagem 2</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Filial</label>
                    <select class="form-select" id="branchFilter">
                        <option value="">Todas as Filiais</option>
                        <option value="filial1">Filial 1</option>
                        <option value="filial2">Filial 2</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Placa</label>
                    <select class="form-select" id="plateFilter">
                        <option value="">Todas as Placas</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Tipo de Item</label>
                    <select class="form-select" id="itemTypeFilter">
                        <option value="">Todos os Tipos</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">Todos</option>
                        <option value="compliant">Conforme</option>
                        <option value="non-compliant">Não Conforme</option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">
                        <i class="fas fa-search"></i>
                        Filtrar
                    </button>
                    <button class="btn btn-outline-primary" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                        Limpar
                    </button>
                </div>
            </div>
            
            <!-- Quick Filters -->
            <div class="quick-filters">
                <button class="quick-filter-btn" onclick="setQuickFilter('today')">Hoje</button>
                <button class="quick-filter-btn" onclick="setQuickFilter('7days')">Últimos 7 dias</button>
                <button class="quick-filter-btn active" onclick="setQuickFilter('30days')">Últimos 30 dias</button>
                <button class="quick-filter-btn" onclick="setQuickFilter('90days')">Últimos 90 dias</button>
            </div>
        </div>

        <!-- Metrics Cards -->
        <div class="metrics-grid" id="metricsGrid">
            <!-- Cards will be dynamically generated -->
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid" id="chartsGrid">
            <!-- Charts will be dynamically generated -->
        </div>

        <!-- DataTable Section -->
        <div class="datatable-section">
            <div class="datatable-header">
                <h3 class="datatable-title">Dados Detalhados</h3>
                <button class="export-btn" onclick="exportToExcel()">
                    <i class="fas fa-download"></i>
                    Exportar
                </button>
            </div>
            
            <div class="table-responsive">
                <table id="dataTable" class="table table-dark table-striped table-hover">
                    <thead>
                        <!-- Headers will be dynamically generated -->
                    </thead>
                    <tbody>
                        <!-- Data will be dynamically loaded -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    
    <script>
        // Global variables
        let currentCollection = 'checklist';
        let currentData = [];
        let dataTable = null;
        let charts = {};
        
        // API Configuration
        const API_BASE_URL = window.location.origin + '/api';
        const ENTERPRISE_ID = 'sA9EmrE3ymtnBqJKcYn7';
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setDefaultDates();
            loadCollectionData();
        });
        
        function initializeDashboard() {
            // Collection tab handlers
            document.querySelectorAll('.collection-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.collection-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentCollection = this.dataset.collection;
                    loadCollectionData();
                });
            });
        }
        
        function setDefaultDates() {
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
        }
        
        function setQuickFilter(period) {
            // Remove active class from all quick filter buttons
            document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const today = new Date();
            let startDate;
            
            switch(period) {
                case 'today':
                    startDate = new Date(today);
                    break;
                case '7days':
                    startDate = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));
                    break;
                case '30days':
                    startDate = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
                    break;
                case '90days':
                    startDate = new Date(today.getTime() - (90 * 24 * 60 * 60 * 1000));
                    break;
            }
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            loadCollectionData();
        }
        
        function applyFilters() {
            loadCollectionData();
        }
        
        function clearFilters() {
            document.getElementById('garageFilter').value = '';
            document.getElementById('branchFilter').value = '';
            document.getElementById('plateFilter').value = '';
            document.getElementById('itemTypeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            setDefaultDates();
            loadCollectionData();
        }
        
        async function loadCollectionData() {
            showLoading();
            
            try {
                let data;
                switch(currentCollection) {
                    case 'checklist':
                        data = await loadChecklistData();
                        break;
                    case 'trips':
                        data = await loadTripsData();
                        break;
                    case 'alerts':
                        data = await loadAlertsData();
                        break;
                    case 'maintenance':
                        data = await loadMaintenanceData();
                        break;
                }
                
                currentData = data;
                updateMetrics(data);
                updateCharts(data);
                updateDataTable(data);
                updateFilters(data);
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Erro ao carregar dados: ' + error.message);
            }
        }
        
        async function loadChecklistData() {
            const response = await fetch(`${API_BASE_URL}/copilot/summary?enterpriseId=${ENTERPRISE_ID}&days=30`);
            if (!response.ok) throw new Error('Erro ao carregar dados de checklist');
            
            const result = await response.json();
            return result.data;
        }
        
        async function loadTripsData() {
            // Placeholder for trips data
            return {
                totalTrips: 150,
                totalDistance: 12500,
                avgSpeed: 45.2,
                fuelConsumption: 8.5
            };
        }
        
        async function loadAlertsData() {
            // Placeholder for alerts data
            return {
                totalAlerts: 25,
                criticalAlerts: 5,
                warningAlerts: 15,
                infoAlerts: 5
            };
        }
        
        async function loadMaintenanceData() {
            // Placeholder for maintenance data
            return {
                scheduledMaintenance: 12,
                completedMaintenance: 8,
                overdueMaintenance: 3,
                upcomingMaintenance: 7
            };
        }
        
        function updateMetrics(data) {
            const metricsGrid = document.getElementById('metricsGrid');
            let metricsHTML = '';
            
            switch(currentCollection) {
                case 'checklist':
                    metricsHTML = `
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Total de Verificações</h3>
                                <i class="metric-icon fas fa-clipboard-check"></i>
                            </div>
                            <div class="metric-value">${data.totalChecks || 0}</div>
                            <div class="metric-subtitle">Verificações realizadas</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Taxa de Conformidade</h3>
                                <i class="metric-icon fas fa-percentage"></i>
                            </div>
                            <div class="metric-value">${data.complianceRate || 0}%</div>
                            <div class="metric-subtitle">Conformidade geral</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Veículos Ativos</h3>
                                <i class="metric-icon fas fa-truck"></i>
                            </div>
                            <div class="metric-value">${data.totalVehicles || 0}</div>
                            <div class="metric-subtitle">Veículos monitorados</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Motoristas</h3>
                                <i class="metric-icon fas fa-users"></i>
                            </div>
                            <div class="metric-value">${data.totalDrivers || 0}</div>
                            <div class="metric-subtitle">Motoristas ativos</div>
                        </div>
                    `;
                    break;
                    
                case 'trips':
                    metricsHTML = `
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Total de Viagens</h3>
                                <i class="metric-icon fas fa-route"></i>
                            </div>
                            <div class="metric-value">${data.totalTrips || 0}</div>
                            <div class="metric-subtitle">Viagens realizadas</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Distância Total</h3>
                                <i class="metric-icon fas fa-road"></i>
                            </div>
                            <div class="metric-value">${(data.totalDistance || 0).toLocaleString()}</div>
                            <div class="metric-subtitle">Quilômetros percorridos</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Velocidade Média</h3>
                                <i class="metric-icon fas fa-tachometer-alt"></i>
                            </div>
                            <div class="metric-value">${data.avgSpeed || 0}</div>
                            <div class="metric-subtitle">km/h</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h3 class="metric-title">Consumo Médio</h3>
                                <i class="metric-icon fas fa-gas-pump"></i>
                            </div>
                            <div class="metric-value">${data.fuelConsumption || 0}</div>
                            <div class="metric-subtitle">km/l</div>
                        </div>
                    `;
                    break;
                    
                // Add cases for other collections...
            }
            
            metricsGrid.innerHTML = metricsHTML;
        }
        
        function updateCharts(data) {
            const chartsGrid = document.getElementById('chartsGrid');
            
            // Clear existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            let chartsHTML = '';
            
            switch(currentCollection) {
                case 'checklist':
                    chartsHTML = `
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Conformidade por Status</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="complianceChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">Evolução Mensal</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="evolutionChart"></canvas>
                            </div>
                        </div>
                    `;
                    break;
                    
                // Add cases for other collections...
            }
            
            chartsGrid.innerHTML = chartsHTML;
            
            // Initialize charts after DOM update
            setTimeout(() => {
                initializeCharts(data);
            }, 100);
        }
        
        function initializeCharts(data) {
            switch(currentCollection) {
                case 'checklist':
                    createComplianceChart(data);
                    createEvolutionChart(data);
                    break;
                    
                // Add cases for other collections...
            }
        }
        
        function createComplianceChart(data) {
            const ctx = document.getElementById('complianceChart');
            if (!ctx) return;
            
            charts.compliance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Conforme', 'Não Conforme'],
                    datasets: [{
                        data: [data.compliantChecks || 0, data.nonCompliantChecks || 0],
                        backgroundColor: ['#1abc9c', '#e74c3c'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ecf0f1',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
        
        function createEvolutionChart(data) {
            const ctx = document.getElementById('evolutionChart');
            if (!ctx) return;
            
            // Sample data for evolution chart
            const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const complianceData = [85, 88, 92, 87, 90, data.complianceRate || 0];
            
            charts.evolution = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Taxa de Conformidade (%)',
                        data: complianceData,
                        borderColor: '#1abc9c',
                        backgroundColor: 'rgba(26, 188, 156, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ecf0f1'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#bdc3c7'
                            },
                            grid: {
                                color: '#34495e'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#bdc3c7'
                            },
                            grid: {
                                color: '#34495e'
                            }
                        }
                    }
                }
            });
        }
        
        function updateDataTable(data) {
            // Destroy existing DataTable
            if (dataTable) {
                dataTable.destroy();
            }
            
            // Sample data for demonstration
            const tableData = generateSampleTableData(currentCollection);
            
            // Update table headers
            updateTableHeaders(currentCollection);
            
            // Initialize DataTable
            dataTable = $('#dataTable').DataTable({
                data: tableData,
                columns: getTableColumns(currentCollection),
                pageLength: 25,
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'btn btn-success btn-sm'
                    }
                ],
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/pt-BR.json'
                },
                order: [[0, 'desc']]
            });
        }
        
        function updateTableHeaders(collection) {
            const thead = document.querySelector('#dataTable thead');
            let headersHTML = '';
            
            switch(collection) {
                case 'checklist':
                    headersHTML = `
                        <tr>
                            <th>Data</th>
                            <th>Placa</th>
                            <th>Motorista</th>
                            <th>Item</th>
                            <th>Status</th>
                            <th>Observações</th>
                        </tr>
                    `;
                    break;
                    
                case 'trips':
                    headersHTML = `
                        <tr>
                            <th>Data</th>
                            <th>Placa</th>
                            <th>Motorista</th>
                            <th>Origem</th>
                            <th>Destino</th>
                            <th>Distância (km)</th>
                            <th>Duração</th>
                        </tr>
                    `;
                    break;
                    
                // Add cases for other collections...
            }
            
            thead.innerHTML = headersHTML;
        }
        
        function getTableColumns(collection) {
            switch(collection) {
                case 'checklist':
                    return [
                        { data: 'date' },
                        { data: 'plate' },
                        { data: 'driver' },
                        { data: 'item' },
                        { 
                            data: 'status',
                            render: function(data) {
                                const badgeClass = data === 'Conforme' ? 'bg-success' : 'bg-danger';
                                return `<span class="badge ${badgeClass}">${data}</span>`;
                            }
                        },
                        { data: 'observations' }
                    ];
                    
                case 'trips':
                    return [
                        { data: 'date' },
                        { data: 'plate' },
                        { data: 'driver' },
                        { data: 'origin' },
                        { data: 'destination' },
                        { data: 'distance' },
                        { data: 'duration' }
                    ];
                    
                // Add cases for other collections...
                default:
                    return [];
            }
        }
        
        function generateSampleTableData(collection) {
            // This would normally come from the API
            const sampleData = [];
            
            switch(collection) {
                case 'checklist':
                    for (let i = 0; i < 50; i++) {
                        sampleData.push({
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR'),
                            plate: `ABC-${Math.floor(Math.random() * 9000) + 1000}`,
                            driver: `Motorista ${i + 1}`,
                            item: ['Farol', 'Pneu', 'Freio', 'Motor'][Math.floor(Math.random() * 4)],
                            status: Math.random() > 0.3 ? 'Conforme' : 'Não Conforme',
                            observations: Math.random() > 0.5 ? 'OK' : 'Necessita atenção'
                        });
                    }
                    break;
                    
                case 'trips':
                    for (let i = 0; i < 50; i++) {
                        sampleData.push({
                            date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR'),
                            plate: `ABC-${Math.floor(Math.random() * 9000) + 1000}`,
                            driver: `Motorista ${i + 1}`,
                            origin: 'São Paulo',
                            destination: 'Rio de Janeiro',
                            distance: Math.floor(Math.random() * 500) + 100,
                            duration: `${Math.floor(Math.random() * 8) + 2}h ${Math.floor(Math.random() * 60)}m`
                        });
                    }
                    break;
            }
            
            return sampleData;
        }
        
        function updateFilters(data) {
            // Update filter options based on current data
            // This would normally populate dropdowns with actual data
        }
        
        function exportToExcel() {
            if (dataTable) {
                dataTable.button('.buttons-excel').trigger();
            }
        }
        
        function showLoading() {
            const metricsGrid = document.getElementById('metricsGrid');
            const chartsGrid = document.getElementById('chartsGrid');
            
            const loadingHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Carregando dados...
                </div>
            `;
            
            metricsGrid.innerHTML = loadingHTML;
            chartsGrid.innerHTML = loadingHTML;
        }
        
        function showError(message) {
            const metricsGrid = document.getElementById('metricsGrid');
            metricsGrid.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    ${message}
                </div>
            `;
        }
    </script>
</body>
</html>

